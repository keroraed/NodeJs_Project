import multer from "multer";import path from "path";import fs from "fs";import { fileURLToPath } from "url";import ApiError from "../errors/ApiError.js";const __filename = fileURLToPath(import.meta.url);const __dirname = path.dirname(__filename);const uploadsDir = path.resolve(__dirname, "../../../uploads/profiles");if (!fs.existsSync(uploadsDir)) {  fs.mkdirSync(uploadsDir, { recursive: true });}const storage = multer.diskStorage({  destination: (_req, _file, cb) => {    cb(null, uploadsDir);  },  filename: (_req, file, cb) => {    const ext = path.extname(file.originalname).toLowerCase();    const uniqueName = `${Date.now()}-${Math.round(Math.random() * 1e9)}${ext}`;    cb(null, uniqueName);  },});const fileFilter = (_req, file, cb) => {  const allowedTypes = ["image/jpeg", "image/jpg", "image/png", "image/webp"];  if (allowedTypes.includes(file.mimetype)) {    cb(null, true);  } else {    cb(      ApiError.badRequest(        "Invalid file type. Only JPEG, PNG, and WebP images are allowed.",      ),      false,    );  }};const upload = multer({  storage,  fileFilter,  limits: { fileSize: 2 * 1024 * 1024 }, 
});export default upload;